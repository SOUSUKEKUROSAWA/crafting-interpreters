// This is Lox comment
print "# Sample of Lox Program";

print "## Type";

print "### Booleans";
print true;
print false;

print "### Numbers";
print 1234;
print 12.34;

print "### Strings";
print "I am a string";
print "";
print "123";

print "### Nil";

print "## Expressions";

print "### 算術演算";
print 1 + 2;
print 1 - 2;
print 1 * 2;
print 1 / 2;
print 1 / 3;
print 1 / 0;
print -4;
print "Hello" + " World";

print "### 大小比較と等式";
print 2 < 1;
print 2 <= 1;
print 2 > 1;
print 2 >= 1;
print 2 == 1;
print "cat" != "dog";
print "pi" == 3.14;
print "3.14" == 3.14;

print "### 論理演算子";
print !true;
print !false;
print true and false;
print true and true;
print false or false;
print true or false;

print "### 優先順位とグループ化";
print  1 + 2 / 3;
print  (1 + 2) / 3;

print "## Variables";

var imAVariable = "here is my value";
print imAVariable;
var imANil;
print imANil;
imANil = "bagels";
print imANil;

print "## Control Flow...";

var condition = 2 > 1;
if (condition) {
    print "yes";
} else {
    print "no";
}

var a = 1;
while (a < 10) {
    print a;
    a = a + 1;
}

for (var a = 1; a < 10; a = a + 1) {
    print a;
}

print "## Functions";

fun printSum(a, b) {
    print a + b;
}
printSum(1, 2);
print printSum;

var result = printSum(1, 2);
print result;

fun returnSum(a, b) {
    return a + b;
}
print returnSum(1, 2);
print returnSum;

print "### Closure";

fun addPair(a, b) {
    return a + b;
}

fun identity(a) {
    return a;
}

print identity(addPair)(1, 2);

fun outerFunction() {
    fun localFunction() {
        print "I'm local!";
    }

    localFunction();
}

outerFunction();

fun returnFunction() {
    var outside = "outside";

    fun inner() {
        print outside;
    }

    return inner;
}

var fn = returnFunction();
fn(); // outside -> inner 関数が，その外側にある変数を，例え外側の関数がリターンした後でも使えるようにするために，変数への参照を閉じ込めて（closure）いる．

print "## Classes";

class Breakfast {
    cook() {
        print "Eggs a-fryin'!";
    }

    serve(who) {
        print "Enjoy your breakfast, " + who + ".";
    }
}

var breakfast = Breakfast(); // クラス自身がインスタンスを作るファクトリ関数になっている．
print breakfast;
breakfast.cook();
breakfast.serve("Alice");

print "### 実体化と初期化";

class Lunch {
    serve(who) {
        print "Enjoy your " + this.meat + " and " + this.bread + ", " + who + ".";
        // print "Enjoy your dishes " + who + ".";
    }
}

var lunch = Lunch();
lunch.time = "noon";
print lunch.time;
lunch.meat = "ham";
lunch.bread = "wheat";
lunch.serve("Alice");

class Dinner {
    init(meat, bread) {
        this.meat = meat;
        this.bread = bread;
    }

    serve(who) {
        print "Enjoy your " + this.meat + " and " + this.bread + ", " + who + ".";
    }
}

var dinner = Dinner("beef", "rye");
dinner.serve("Bob");

// エッジケース（init が直接呼び出される場合）
dinner.init("pork", "white");
dinner.serve("Alice");

// エッジケース（init で return する場合）
class Dinner2 {
    init() {
        // return "I'm not eating that!"; // 静的エラー
        return;
    }
}

var dinner2 = Dinner2();
print dinner2;

var dinner3 = dinner2.init();
print dinner3;

print "### 継承";

class Brunch < Dinner {
    init(meat, bread, drink) {
        super.init(meat, bread);
        this.drink = drink;
    }

    recommend() {
        print "How about a " + this.drink + "?";
    }
}

var brunch = Brunch("sausage", "sourdough", "coffee");
brunch.recommend();
brunch.serve("Alice");

// 継承のエッジケース
class A {
    method() {
        print "A method";
    }
}

class B < A {
    method() {
        print "B method";
    }
    test() {
        super.method();
    }
}

class C < B {}

C().test(); // expected: "A method"

// 継承の異常系
// class Oops < Oops {}
// var NotAClass = "I am not a class";
// class Subclass < NotAClass {}

// クラスの静的メソッド（challenge 12.1）
// class Math {
//     static square(n) {
//         return n * n;
//     }
// }

// var math = Math.square;

// print math(5);

// 継承の異常系
// class Eclair {
//     cook() {
//         super.cook(); // Error.
//         print "Cooking an eclair!";
//     }
// }

// super.notEvenInAClass(); // Error.

// ユーザー定義のゲッター（challenge 12.2）

// class Circle {
//     init(radius) {
//         this.radius = radius;
//     }

//     area {
//         return this.radius * this.radius * 3.141592653;
//     }
// }

// var circle = Circle(4);
// print circle.area;

// class Circle2 {
//     init(radius) {
//         this.radius = radius;
//     }

//     area () { // メソッドとゲッターを区別できているかの確認
//         return this.radius * this.radius * 3.141592653;
//     }
// }

// var circle2 = Circle2(4);
// print circle2.area();

// Trait の導入

// trait A {
//   a() {
//     print "a";
//   }
// }

// trait B1 {
//   b1() {
//     print "b1";
//   }
// }

// trait B2 {
//   b2() {
//     print "b2";
//   }
// }

// trait B with B1, B2 {
//   b() {
//     this.b1();
//     this.b2();
//   }
// }

// class C with A, B {}

// var c = C();
// c.a();
// c.b();

// inner

// class Doughnut {
//     cook() {
//         print "Fry until golden brown.";
//         inner();
//         print "Place in a nice box.";
//     }
// }

// class BostonCream < Doughnut {
//     cook() {
//         print "Pipe full of custard and coat with chocolate.";
//     }
// }

// BostonCream().cook();

// Array

// var array = Array(3);

// print array; // "[null, null, null]".

// // "length" returns the number of elements.
// print array.length; // "3".

// // "set" sets the element at the given index to the given value.
// array.set(1, "new");

// // "get" returns the element at a given index.
// print array.get(1); // "new".

print "## Benchmark";

fun fib(n) {
    if (n < 2) return n;
    return fib(n-1) + fib(n-2);
}

var before = clock();
print fib(40);
var after = clock();
print after - before;
